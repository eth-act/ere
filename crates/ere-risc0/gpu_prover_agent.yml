image: agent
runtime: nvidia
pull_policy: never
restart: always
depends_on:
  - postgres
  - redis
  - minio
mem_limit: 4G
cpu_count: 4
environment:
  DATABASE_URL: postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}
  REDIS_URL: redis://${REDIS_HOST}:6379
  S3_URL: http://${MINIO_HOST}:9000
  S3_BUCKET: ${MINIO_BUCKET}
  S3_ACCESS_KEY: ${MINIO_ROOT_USER}
  S3_SECRET_KEY: ${MINIO_ROOT_PASS}
  RUST_LOG: ${RUST_LOG}
  RUST_BACKTRACE: 1
entrypoint: /app/agent -t prove
# comment-out if running in CPU proving mode
deploy:
  resources:
    reservations:
      devices:
        - driver: nvidia
          # TODO: how to scale this with N gpus?
          device_ids: ['0']
          capabilities: [gpu]
