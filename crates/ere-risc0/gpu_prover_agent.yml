image: ere-risc0/agent:${RISC0_VERSION}
runtime: nvidia
pull_policy: never
restart: always
depends_on:
  - postgres
  - redis
  - minio
mem_limit: 4G
cpu_count: 4
environment:
  DATABASE_URL: postgresql://worker:password@postgres:5432/taskdb
  REDIS_URL: redis://redis:6379
  S3_URL: http://minio:9000
  S3_BUCKET: workflow
  S3_ACCESS_KEY: admin
  S3_SECRET_KEY: password
  RUST_LOG: ${RUST_LOG}
  RUST_BACKTRACE: 1
entrypoint: /app/agent -t prove
deploy:
  resources:
    reservations:
      devices:
        - driver: nvidia
          device_ids: ['0']
          capabilities: [gpu]
